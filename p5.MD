P5_resiliencescan_email_delivery
name: P5_resiliencescan_email_delivery description: Add safe, auditable email delivery for ResilienceScan reports without desktop Outlook automation

PHASE TASK (DELIVERY)
This phase adds report delivery as a SERVICE concern, not a desktop automation concern.
Email must work headlessly inside the container.
input: project: "ResilienceScan" architecture_reference: "outputs/architecture/resiliencescan_architecture_and_principles.md" web_reference: "P4_resiliencescan_web_interface" reporting_reference: "P3_resiliencescan_reporting_engine_quarto_scrol" delivery_modes: - smtp_recommended - outbox_bridge_optional email_content: default_subject: "Your Resilience Scan Report" default_sender_name: "ResilienceScan" attachment_types: - pdf - html privacy_constraints: - "No hardcoded credentials" - "No sending without explicit user action" - "Dry-run must be available"

steps:

Implement SMTP-based email delivery (primary path):
Use standard SMTP with TLS
Support authentication via environment variables
Allow configuration of:
SMTP host
port
username
password (or app password)
from-address
Attach one or more generated reports
Send plain-text email body (HTML optional)
Implement delivery safety features:
Dry-run / preview mode (no emails sent)
Recipient validation (basic sanity checks)
Size limits for attachments
Per-send logging (timestamp, recipients, files)
Integrate email sending into the web interface:
POST /send/email
User selects:
report(s)
recipient(s)
subject/body overrides (optional)
UI must clearly indicate dry-run vs live send
Implement optional "Outbox Bridge" mode (secondary path):
When enabled, do NOT send email
Instead, generate:
.eml files OR
outbox.csv with recipient, subject, attachment paths
Write artifacts to /outbox volume
Document how a host-side script can pick these up for Outlook sending
Add delivery logging and audit trail:
logs/email.log
Include run_id linkage
Record success/failure per recipient
Add configuration via environment variables only
output: format: files generated_artifacts: - app/email.py - app/web/routes/email.py - logs/email.log - outbox/ (optional, when bridge mode enabled) documentation: - path: outputs/architecture/P5_email_delivery_notes.md

configuration: environment_variables: SMTP_HOST: "smtp.example.org" SMTP_PORT: "587" SMTP_USERNAME: "<secret>" SMTP_PASSWORD: "<secret>" SMTP_FROM: "resiliencescan@example.org" EMAIL_MODE: "smtp | dry-run | outbox"

constraints:

"No Outlook COM automation inside the container"
"Email sending must be explicit and user-triggered"
"Dry-run mode must be the default"
"All email actions must be logged"
"Must work in headless Linux containers"
style: delivery_philosophy: - explicit - auditable - reversible failure_mode: - fail_per_recipient - continue_with_others

success_criteria:

"SMTP emails can be sent successfully from the container"
"Dry-run mode produces no outbound mail"
"Outbox bridge artifacts are generated correctly when enabled"
"Every send action is logged and traceable"