% This is a combination of Pandoc templating and LaTeX
% Pandoc templating https://pandoc.org/MANUAL.html#templates
% See the README for help

% Get the theme commands
$_titlepage-alignments.tex()$
$_title-themes.tex()$
$_author-affiliation-themes.tex()$
$_header-footer-date-themes.tex()$

%set up blocks so user can specify order
\newcommand{\titleblock}{$if(title)$
$if(subtitle)$
\newlength{\betweentitlesubtitle}
\setlength{\betweentitlesubtitle}{$if(titlepage-theme.title-subtitle-space-between)$$titlepage-theme.title-subtitle-space-between$$else$\baselineskip$endif$}
$endif$
{$if(titlepage-theme.title-align)$\titlepagetitlealign$endif$
$if(titlepage-theme.title-fontfamily)$\titlepagetitlefont$endif$
{\titlepagetitleblock}
}
\newlength{\aftertitle}
\setlength{\aftertitle}{$if(titlepage-theme.title-space-after)$$titlepage-theme.title-space-after$$else$0pt$endif$}

\vspace{\aftertitle}
$else$$endif$}

\newcommand{\authorblock}{$if(author)$
{$if(titlepage-theme.author-align)$\titlepageauthoralign$endif$
$if(titlepage-theme.author-fontfamily)$\titlepageauthorfont$endif$
\titlepageauthorblock
}
\newlength{\afterauthor}
\setlength{\afterauthor}{$if(titlepage-theme.author-space-after)$$titlepage-theme.author-space-after$$else$0pt$endif$}

\vspace{\afterauthor}
$else$$endif$}

\newcommand{\affiliationblock}{$if(author)$
{$if(titlepage-theme.afiliation-align)$\titlepageaffiliationalign$endif$
$if(titlepage-theme.affiliation-fontfamily)$\titlepageaffiliationfont$endif$
\titlepageaffiliationblock
}
\newlength{\afteraffiliation}
\setlength{\afteraffiliation}{$if(titlepage-theme.affiliation-space-after)$$titlepage-theme.affiliation-space-after$$else$0pt$endif$}

\vspace{\afteraffiliation}
$else$$endif$}

\newcommand{\logoblock}{$if(titlepage-logo)$
{$if(titlepage-theme.logo-align)$\titlepagelogoalign$endif$
\includegraphics[width=$if(titlepage-theme.logo-size)$$titlepage-theme.logo-size$$else$0.2\textwidth$endif$]{$titlepage-logo$}
}
\newlength{\afterlogo}
\setlength{\afterlogo}{$if(titlepage-theme.logo-space-after)$$titlepage-theme.logo-space-after$$else$0pt$endif$}

\vspace{\afterlogo}
$else$$endif$}

\newcommand{\footerblock}{$if(titlepage-footer)$
{$if(titlepage-theme.footer-align)$\titlepagefooteralign$endif$
$if(titlepage-theme.footer-fontfamily)$\titlepagefooterfont$endif$
\titlepagefooterblock
}
\newlength{\afterfooter}
\setlength{\afterfooter}{$if(titlepage-theme.footer-space-after)$$titlepage-theme.footer-space-after$$else$0pt$endif$}

\vspace{\afterfooter}
$else$$endif$}

\newcommand{\dateblock}{$if(date)$
{$if(titlepage-theme.date-align)$\titlepagedatealign$endif$
$if(titlepage-theme.date-fontfamily)$\titlepagedatefont$endif$
\titlepagedateblock
}
\vspace{$if(titlepage-theme.date-space-after)$$titlepage-theme.date-space-after$$else$0pt$endif$}
$else$$endif$}

\newcommand{\headerblock}{$if(titlepage-header)$
{$if(titlepage-theme.header-align)$\titlepageheaderalign$endif$
$if(titlepage-theme.header-fontfamily)$\titlepageheaderfont$endif$
\titlepageheaderblock
}
\newlength{\afterheader}
\setlength{\afterheader}{$if(titlepage-theme.header-space-after)$$titlepage-theme.header-space-after$$else$0pt$endif$}

\vspace{\afterheader}
$else$$endif$}

$if(titlepage-geometry)$
\newgeometry{$for(titlepage-geometry)$$titlepage-geometry$$sep$,$endfor$}
$endif$

$if(titlepage-theme.page-html-color)$
\definecolor{pgcolor}{HTML}{$titlepage-theme.page-html-color$}
\pagecolor{pgcolor}\afterpage{\nopagecolor}
$else$
$if(titlepage-theme.page-color)$
\colorlet{pgcolor}{$titlepage-theme.page-color$}
\pagecolor{pgcolor}\afterpage{\nopagecolor}
$endif$
$endif$

% background image
$if(titlepage-bg-image)$
\newlength{\bgimagesize}
\setlength{\bgimagesize}{$if(titlepage-theme.bg-image-size)$$titlepage-theme.bg-image-size$$else$\paperwidth$endif$}
\LENGTHDIVIDE{\bgimagesize}{\paperwidth}{\theRatio} % from calculator pkg
\This$if(titlepage-theme.bg-image-location)$$titlepage-theme.bg-image-location$$else$ULCorner$endif$WallPaper{\theRatio}{$titlepage-bg-image$}
$endif$

\thispagestyle{empty} % no page numbers on titlepages
$if(titlepage-theme.page-fontfamily)$\titlepagefont$endif$

$if(titlepage-theme.vrule-width)$
$if(titlepage-theme.vrule-text)$
\newcommand{\vrulecode}{\noindent\colorbox{$titlepage-theme.vrule-color$}{\begin{minipage}[b][0.99\textheight][c]{\vrulewidth}$if(titlepage-theme.vrule-text)$
\centering\rotatebox{90}{\makebox[0.88\textheight][r]{$if(titlepage-theme.vrule-text-fontstyle)$$for(titlepage-theme.vrule-text-fontstyle)$\$titlepage-theme.vrule-text-fontstyle${$endfor$$endif$$if(titlepage-theme.vrule-text-color)$\color{$titlepage-theme.vrule-text-color$}$endif$$titlepage-theme.vrule-text$$for(titlepage-theme.vrule-text-fontstyle)$}$endfor$}}$endif$\end{minipage}}}
$else$
\newcommand{\vrulecode}{\rule{\vrulewidth}{\textheight}}
$endif$
\newlength{\vrulewidth}
\setlength{\vrulewidth}{$titlepage-theme.vrule-width$}
\newlength{\B}
\setlength{\B}{\ifdim\vrulewidth > 0pt $titlepage-theme.vrule-space$\else 0pt\fi}
\newlength{\minipagewidth}
\ifthenelse{\equal{$titlepage-theme.vrule-align$}{left} \OR \equal{$titlepage-theme.vrule-align$}{right} }
{% True case
\setlength{\minipagewidth}{\textwidth - \vrulewidth - \B - 0.1\textwidth}
}{
\setlength{\minipagewidth}{\textwidth - 2\vrulewidth - 2\B - 0.1\textwidth}
}
$else$
\newlength{\minipagewidth}
\setlength{\minipagewidth}{\textwidth}
$endif$
$if(titlepage-theme.vrule-width)$
\ifthenelse{\equal{$titlepage-theme.vrule-align$}{left} \OR \equal{$titlepage-theme.vrule-align$}{leftright}}
{% True case
\raggedleft % needed for the minipage to work
\vrulecode
\hspace{\B}
}{%
\raggedright % else it is right only and width is not 0
}
$else$
\raggedright % single minipage
$endif$
% [position of box][box height][inner position]{width}
% [s] means stretch out vertically; assuming there is a vfill
\begin{minipage}[b][\textheight][s]{\minipagewidth}
$if(titlepage-theme.page-align)$\titlepagepagealign$endif$
$for(titlepage-theme.elements)$
$titlepage-theme.elements$
$sep$
$endfor$
\end{minipage}
\ifthenelse{\equal{$titlepage-theme.vrule-align$}{right} \OR \equal{$titlepage-theme.vrule-align$}{leftright} }%
{% True case
\hspace{\B}
\vrulecode
}{}
$if(titlepage-geometry)$
\restoregeometry
$endif$