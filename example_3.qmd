---
title: "`r params$company`"
format:
  pdf:
    documentclass: article
    number-sections: false
    toc: false
    geometry: margin=1in
params:
  company: "Scania Logistics NL"
execute:
  echo: false
  warning: false
  message: false
---

```{r setup, include=FALSE}
library(tidyverse)
library(fmsb)
library(scales)
library(janitor)

# Read data
data <- read_csv("data/cleaned_master.csv") %>% clean_names()

# Filter for company
this <- data %>%
  filter(tolower(company_name) == tolower(params$company)) %>%
  slice(1)

# Radar plot function with safe fallback
radar_plot <- function(df, title, prefix = "") {
  dims <- c("redundancy", "collaboration", "flexibility", "visibility", "agility")
  
  # Extract values safely, default to 0 if missing
  values <- map_dbl(dims, ~ {
    colname <- paste0(prefix, .x)
    if (colname %in% names(df)) {
      val <- suppressWarnings(as.numeric(df[[colname]]))
      ifelse(is.na(val), 0, val)
    } else {
      0
    }
  })
  
  # Always create valid 3-row dataframe
  radar_df <- data.frame(rbind(rep(5, length(dims)), rep(0, length(dims)), values))
  colnames(radar_df) <- str_to_title(dims)
  
  op <- par(mar = c(1, 1, 3, 1))
  radarchart(
    radar_df,
    axistype = 1,
    pcol = "#1f77b4", pfcol = alpha("#1f77b4", 0.3), plwd = 2,
    cglcol = "grey", cglty = 1, axislabcol = "grey", caxislabels = 0:5, cglwd = 0.8,
    vlcex = 0.9, title = title
  )
  par(op)
}
```

```{r radar-plots, fig.width=8, fig.height=8}
par(mfrow = c(2, 2)) # 2x2 layout
radar_plot(this, "Overall Capability Profile")
radar_plot(this, "Upstream Capability Profile", "upstream_")
radar_plot(this, "Internal Capability Profile", "internal_")
radar_plot(this, "Downstream Capability Profile", "downstream_")
```
